<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8">
    <title>Employee & Capital Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="container py-4">
    <h2 class="text-center">Employee Growth Over Time</h2>
    
    <div class="row">
        <div class="col-md-4">
            <h3 class="text-center">Employees by Country</h3>
            <canvas id="countryChart"></canvas>
            <h3 class="text-center mt-4">Employees by Occupation</h3>
            <canvas id="occupationChart"></canvas>
        </div>
        <div class="col-md-8">
            <canvas id="employeeChart" class="mb-4"></canvas>
        </div>
    </div>

    <script>
        const data = [
            { "Quarter": "Q1-2022", "Capital": 4.06, "Countries": { "USA": 5, "India": 2, "France": 2, "UK": 1, "Australia": 2 }, "Occupations": { "Sales": 3, "Operations": 0, "Software Engineering": 2, "Information Technology": 1, "Marketing": 0, "Administration": 1, "Human Resources": 0 } },
            { "Quarter": "Q2-2022", "Capital": 4.06, "Countries": { "USA": 6, "India": 2, "France": 2, "UK": 1, "Australia": 2 }, "Occupations": { "Sales": 3, "Operations": 0, "Software Engineering": 2, "Information Technology": 1, "Marketing": 1, "Administration": 1, "Human Resources": 0 } },
            { "Quarter": "Q3-2022", "Capital": 8.77, "Countries": { "USA": 7, "India": 3, "France": 2, "UK": 1, "Australia": 2 }, "Occupations": { "Sales": 3, "Operations": 0, "Software Engineering": 2, "Information Technology": 1, "Marketing": 1, "Administration": 1, "Human Resources": 2 } }
        ];

        const ctxEmployee = document.getElementById('employeeChart').getContext('2d');
        const ctxCountry = document.getElementById('countryChart').getContext('2d');
        const ctxOccupation = document.getElementById('occupationChart').getContext('2d');

        let countryChart, occupationChart;

        const totalEmployees = data.map(d => Object.values(d.Countries).reduce((a, b) => a + b, 0));
        const capitalRaises = data.map(d => d.Capital);
        
        const employeeChart = new Chart(ctxEmployee, {
            type: 'line',
            data: {
                labels: data.map(d => d.Quarter),
                datasets: [{
                    label: 'Total Employees',
                    data: totalEmployees,
                    borderColor: 'blue',
                    fill: false,
                    pointStyle: data.map(d => d.Capital > 4.06 ? 'star' : 'circle'),
                    pointRadius: data.map(d => d.Capital > 4.06 ? 8 : 4),
                    pointHoverRadius: 10,
                }]
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        type: 'category',
                        title: { display: true, text: 'Quarter' }
                    },
                    y: {
                        title: { display: true, text: 'Total Employees' }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = ' Employees: ' + context.raw;
                                if (capitalRaises[context.dataIndex] > 4.06) {
                                    label += ' (⭐ Capital Raised)';
                                }
                                return label;
                            }
                        }
                    }
                },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const index = elements[0].index;
                        updatePieCharts(index);
                    }
                }
            }
        });

        function updatePieCharts(index) {
            const selectedData = data[index];

            if (countryChart) countryChart.destroy();
            countryChart = new Chart(ctxCountry, {
                type: 'pie',
                data: {
                    labels: Object.keys(selectedData.Countries),
                    datasets: [{
                        data: Object.values(selectedData.Countries),
                        backgroundColor: ['red', 'blue', 'green', 'yellow', 'orange']
                    }]
                }
            });

            if (occupationChart) occupationChart.destroy();
            occupationChart = new Chart(ctxOccupation, {
                type: 'pie',
                data: {
                    labels: Object.keys(selectedData.Occupations),
                    datasets: [{
                        data: Object.values(selectedData.Occupations),
                        backgroundColor: ['purple', 'cyan', 'pink', 'grey', 'brown', 'black', 'magenta']
                    }]
                }
            });
        }

        updatePieCharts(0);
    </script>
</body>
</html>